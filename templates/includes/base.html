{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    
    <title>{% block title %}{% endblock %}</title>
    
    <link rel="stylesheet" href="{% static 'base.css' %}">
    <link rel="stylesheet" href="{% static 'messages.css' %}">

    {% block extra_css %}{% endblock %}

   
</head>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const body = document.body;
        const themeToggle = document.getElementById("theme-toggle");
        const submenuBtn = document.querySelector(".submenu-btn");
        const submenu = document.querySelector(".submenu");

        // Handle submenu toggle
        if (submenuBtn) {
            submenuBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                submenu.classList.toggle("open");
            });
        }

        // Close submenu when clicking outside
        document.addEventListener("click", () => {
            submenu.classList.remove("open");
        });

        // Load saved theme
        if (localStorage.getItem("theme") === "dark") {
            body.classList.add("dark-theme");
            themeToggle.textContent = "Light Theme";
        }

        // Theme toggle
        themeToggle.addEventListener("click", () => {
            body.classList.toggle("dark-theme");
            const isDark = body.classList.contains("dark-theme");

            themeToggle.textContent = isDark ? "Light Theme" : "Dark Theme";
            localStorage.setItem("theme", isDark ? "dark" : "light");
        });
    });

</script>

<body>
    <header>
        <a href="{% url 'venue_list' %}" class="site-title">
             {% include "includes/logo.svg.html" %}
        </a>
        <nav class="main-nav">
            {% if user.is_authenticated %}
                <div class="user-menu">
                    {% if user.is_authenticated and user.user_type == 'venue_admin' and venue_id %}
                        <a href="{% url 'venue_dashboard' venue_id %}" class="dashboard-link">Dashboard</a>
                    {% endif %}


                    <button class="user-menu-btn" id="userMenuBtn">
                        {{ user.username }} 
                        <span class="triangle">&#x25BC;</span>
                    </button>

                    <div class="user-dropdown" id="userDropdown" role="menu" aria-labelledby="userMenuBtn">
                        <a href="{% url 'profile' %}" role="menuitem">Profile</a>

                        <!-- Settings with submenu -->
                        <div class="submenu">
                            <button class="submenu-btn" role="menuitem">
                                Settings <span class="triangle">&#x25B6;</span>
                            </button>
                            <div class="submenu-content">
                                <button id="theme-toggle" class="submenu-item">Dark Theme</button>
                            </div>
                        </div>

                        <form method="post" action="{% url 'logout' %}" class="logout-form" role="none">
                            {% csrf_token %}
                            <button type="submit" class="logout-link" role="menuitem">Logout</button>
                        </form>
                         {% if user.is_authenticated and user.user_type != 'venue_admin' %}
                            <a href="{% url 'my_reservations' %}" role="menuitem">My Reservations</a>
                        {% endif %}
                    </div>


                </div>
            {% else %}
                <a href="{% url 'apply_venue' %}" class="apply-venue-btn">Apply to Register a Venue</a>
                <span class="separator">|</span>
                <a href="{% url 'login' %}" class="nav-link">Login</a>
                <span class="separator">|</span>
                <a href="{% url 'signup' %}" class="nav-link">Sign Up</a>
            {% endif %}
        </nav>
    </header>

    <main>
        {% include 'includes/messages.html' %}

        {% block content %}{% endblock %}
    </main>

    <footer>
        &copy; 2025 OpenSpots. All rights reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('userMenuBtn');
            const dropdown = document.getElementById('userDropdown');
            const triangle = btn.querySelector('.triangle');

            if (btn && dropdown) {
                btn.addEventListener('click', e => {
                    e.stopPropagation();
                    dropdown.classList.toggle('show');
                    triangle.classList.toggle('rotate');
                });

                document.addEventListener('click', () => {
                    dropdown.classList.remove('show');
                    triangle.classList.remove('rotate');
                });

                dropdown.addEventListener('click', e => e.stopPropagation());
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
            const alerts = document.querySelectorAll('.fade-message');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.style.display = 'none', 600);
                }, 2000);
            });
        });

    </script>

    {% block extra_js %}{% endblock %}

</body>
</html>
