{% extends 'includes/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ venue.name }} - OpenSpots{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'venues/venue_detail.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
{% endblock %}

{% block content %}

<!-- HERO SECTION -->
<div class="hero-section" style="background-image:url('{% if venue.image %}{{ venue.image.url }}{% endif %}')">
  <div class="hero-overlay"></div>
  <div class="hero-title">
    <h1>{{ venue.name }}</h1>
    <p>{{ venue.location }}</p>
  </div>
</div>

<div class="page-container">

  <!-- LEFT SIDE -->
  <div>

    <!-- TABS -->
    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="about">{% trans "About" %}</div>
      <div class="tab" data-tab="menu">{% trans "Menu" %}</div>
      <div class="tab" data-tab="photos">{% trans "Photos" %}</div>
      <div class="tab" data-tab="reviews">{% trans "Reviews" %}</div>
    </div>

    <!-- ABOUT SECTION -->
    <div class="tab-content active" id="about">
      <p class="venue-description">{{ venue.description }}</p>
      <h3>{% trans "Location" %}</h3>
      <div id="venue-map"></div>
    </div>

    <!-- MENU SECTION -->
    <div class="tab-content" id="menu">
      <h3>{% trans "Menu" %}</h3>
      <p>{% trans "This venue has not added a menu yet." %}</p>
    </div>

    <!-- PHOTOS SECTION -->
    <div class="tab-content" id="photos">
      <h3>{% trans "Photos" %}</h3>
      <div class="gallery">
        {% for image in venue.gallery_images.all %}
          <img src="{{ image.image.url }}" alt="Photo">
        {% empty %}
          <p>{% trans "No photos available." %}</p>
        {% endfor %}
      </div>
    </div>

    <!-- REVIEWS SECTION -->
    <div class="tab-content" id="reviews">
      <h3>{% trans "Reviews" %}</h3>
      <div class="reviews">
        {% for review in venue.reviews.all %}
          <div class="review-card">
            <strong>{{ review.user.username }}</strong>
            <div class="stars">★★★★★</div>
            <p>{{ review.comment }}</p>
          </div>
        {% empty %}
          <p>{% trans "No reviews yet." %}</p>
        {% endfor %}
      </div>
    </div>

  </div>

  <!-- RIGHT SIDE RESERVATION CARD -->
  <div>
    <div class="reserve-card">
      <h3>{% trans "Reserve a Table" %}</h3>

      {% if user.is_authenticated %}
        {% include "venues/partials/_customer_reservation_form.html" with form=form submit_text="Submit Reservation" %}
      {% else %}
        <a class="btn btn-success w-100" href="{% url 'account_login' %}?next={{ request.path }}">
          {% trans "Log in to reserve" %}
        </a>
      {% endif %}
    </div>
  </div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

{{ venue.latitude|default:"null"|json_script:"venue_lat" }}
{{ venue.longitude|default:"null"|json_script:"venue_lng" }}

<script>
// MAP INIT
const lat = JSON.parse(document.getElementById("venue_lat").textContent);
const lng = JSON.parse(document.getElementById("venue_lng").textContent);
if (lat && lng) {
  const map = L.map('venue-map').setView([lat, lng], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  L.marker([lat, lng]).addTo(map);
}

// TABS
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    contents.forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});
</script>

{% endblock %}
