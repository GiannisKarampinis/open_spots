{% extends "includes/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'venues/edit_reservation_status.css' %}">
{% endblock %}

{% block content %}
<div id="editStatusModal" class="modal-overlay">
    <!-- Modal content box -->
    <div class="modal-content">
        <button class="modal-close" aria-label="Close modal">&times;</button>

        <h2>Update Arrival Status</h2>

        <div class="reservation-info">
            <p><strong>Customer:</strong> {{ reservation.user.username }}</p>
            <p><strong>Date:</strong> {{ reservation.date }}</p>
            <p><strong>Time:</strong> {{ reservation.time }}</p>
            <p><strong>Party Size:</strong> {{ reservation.party_size }}</p>
        </div>

        <form id="updateStatusForm" method="post" novalidate>
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="mb-3">
                {{ form.arrival_status.label_tag }}
                {{ form.arrival_status }}
                {% for error in form.arrival_status.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>

            <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-primary">Update Status</button>
                <a href="{% url 'venue_dashboard' reservation.venue.id %}" class="btn btn-secondary modal-close">Cancel</a>
            </div>
        </form>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal-overlay">
            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmDesc">
                <h2 id="confirmTitle">Confirm Update</h2>
                <p id="confirmDesc">Are you sure you want to update the arrival status?</p>
                <div class="d-flex">
                    <button id="confirmCancel" class="btn btn-secondary">Cancel</button>
                    <button id="confirmOk" class="btn btn-primary">Yes, Update</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editModal = document.getElementById('editStatusModal');
            const confirmModal = document.getElementById('confirmModal');

            // Close buttons
            const closeButtons = editModal.querySelectorAll('.modal-close');
            closeButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = "{% url 'venue_dashboard' reservation.venue.id %}";
                });
            });

            // Close if clicked outside
            editModal.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    window.location.href = "{% url 'venue_dashboard' reservation.venue.id %}";
                }
            });

            editModal.classList.add('show');

            const confirmCancel = document.getElementById('confirmCancel');
            const confirmOk = document.getElementById('confirmOk');
            const updateForm = document.getElementById('updateStatusForm');

            updateForm.addEventListener('submit', (e) => {
                e.preventDefault();
                confirmModal.classList.add('show');
            });

            confirmCancel.addEventListener('click', () => {
                confirmModal.classList.remove('show');
            });

            confirmOk.addEventListener('click', () => {
                confirmModal.classList.remove('show');
                updateForm.submit();
            });

            confirmModal.addEventListener('click', (e) => {
                if (e.target === confirmModal) {
                    confirmModal.classList.remove('show');
                }
            });
        });
    </script>
</div>
{% endblock %}
